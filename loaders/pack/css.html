{{- $section := .Section -}}
{{- $formats := .Page.Params.Format.Kind -}}
{{- $destination := printf "assets/scripts/" -}}


{{- if and ( .IsSection ) ( .Page.Params.Paged ) -}}
    {{- $destination = printf "assets/scripts/%s/%s/deffers/" .Section .Page.Params.Paged -}}
{{- else -}}
    {{- $destination = printf "assets/scripts/%s/list/deffers/" .Section -}}
{{- end -}}


{{- if .IsHome -}}

    {{- $destination = printf "assets/scripts/home/deffers/" -}}

{{- else if and ( .IsPage ) ( .Section ) -}}

    {{- $destination = printf "assets/scripts/%s/deffers/" .Section -}}

{{- else -}}

    {{- $destination = printf "assets/scripts/page/deffers/" -}}

{{- end -}}


{{- $master_css := resources.Get "scripts/based/css/pack.scss" | toCSS -}}
{{- $themes_css := resources.Get "scripts/based/css/foot.scss" | toCSS -}}
{{- $extras_css := resources.Get "scripts/based/css/over.scss" | toCSS -}}
{{- $module_css := resources.Get "scripts/based/css/over.scss" | toCSS -}}
{{- $format_css := resources.Get "scripts/based/css/over.scss" | toCSS -}}


{{- if .Section -}}

    {{- $get_module := "" -}}

    {{- if and ( .Page.Params.Model ) ( .Page.Params.Paged ) -}}

        {{- $get_module = printf "scripts/%s/%s/%s" .Section .Page.Params.Model .Page.Params.Paged -}}
        {{- $destination = printf "assets/scripts/%s/deffers/module/%s/%s" .Section .Page.Params.Model .Page.Params.Paged  -}}

    {{- else if and ( .Page.Params.Model ) ( .IsPage ) -}}

        {{- $get_module = printf "scripts/%s/%s/page" .Section .Page.Params.Model -}}
        {{- $destination = printf "assets/scripts/%s/deffers/module/%s/page" .Section .Page.Params.Model -}}

    {{- else if .Page.Params.Model -}}

        {{- $get_module = printf "scripts/%s/%s/item" .Section .Page.Params.Model -}}
        {{- $destination = printf "assets/scripts/%s/deffers/module/%s/list" .Section .Page.Params.Model -}}

    {{- else if .Page.Params.Paged -}}

        {{- $get_module = printf "scripts/%s/default/%s" .Section .Page.Params.Paged -}}
        {{- $destination = printf "assets/scripts/%s/deffers/module/default/%s" .Section .Page.Params.Paged -}}

    {{- else if .IsPage -}}

        {{- $get_module = printf "scripts/%s/default/page" .Section -}}
        {{- $destination = printf "assets/scripts/%s/deffers/module/default/page/" .Section -}}

    {{- else -}}

        {{- $get_module = printf "scripts/%s/default/item" .Section -}}
        {{- $destination = printf "assets/scripts/%s/deffers/module/default/list/" .Section -}}

    {{- end -}}

    {{- $try_module := printf "%s/css/pack.scss" $get_module -}}
    {{- with resources.Get $try_module -}}{{- $module_css = resources.Get . | toCSS -}}{{- end -}}

{{- end -}}


{{- if .Page.Params.Format.Kind -}}

    {{- $skins := printf "format/%s/model/%s.html" .Page.Params.Format.Kind .Page.Params.Format.Skin -}}
    {{- $modul := printf "format/%s/model/%s.html" .Page.Params.Format.Kind .Section -}}
    {{- $forma := printf "format/%s/model/default.html" .Page.Params.Format.Kind -}}
    {{- $gform := "" -}}
   
    {{- if templates.Exists ( printf "partials/%s" $skins ) -}}

        {{- $gform = printf "scripts/formats/%s/%s" .Page.Params.Format.Kind .Page.Params.Format.Skin -}}
        {{- $formats = printf "assets/scripts/%s/deffers/%s" .Section $skins  -}}
        

    {{- else if templates.Exists ( printf "partials/%s" $modul ) -}}

        {{- $gform = printf "scripts/formats/%s/%s" .Page.Params.Format.Kind .Section -}}
         {{- $formats = printf "assets/scripts/%s/deffers/%s" .Section $modul  -}}
    
    {{- else if templates.Exists ( printf "partials/%s" $forma ) -}}

        {{- $gform = printf "scripts/formats/%s/default" .Page.Params.Format.Kind -}}
        {{- $formats = printf "assets/scripts/%s/deffers/%s" .Section $forma -}}

    {{- else -}}

        {{- $gform = printf "scripts/formats/default/default" -}}
        {{- $formats = printf "assets/scripts/%s/deffers/format/default/main" .Section -}}

    {{- end -}}

    {{- $try_format := printf "%s/css/pack.scss" $gform -}}
    {{- with resources.Get $try_format -}}{{- $format_css = resources.Get . | toCSS -}}{{- end -}}

{{- end -}}


{{- with .Site.Params.Themes -}}
    {{- $theme_path := printf "scripts/themes/%s/css/pack.scss" . -}}
    {{- $themes_css = resources.Get $theme_path | toCSS -}}
{{- end -}}


{{- with resources.Get "scripts/deffers.css" -}}
    {{- $extras_css := resources.Get . -}}
{{- end -}}


{{- if and ( resources.Get $master_css ) ( resources.Get $format_css ) ( resources.Get $module_css ) ( resources.Get $themes_css ) ( resources.Get $extras_css ) -}}
    
    {{- $path := "" -}}
    {{- $dest := "" -}}

    {{- if .Page.Params.Format.Kind -}}
        {{- $dest = printf "%s/foot.css" $formats -}}
    {{- else -}}
        {{- $dest = printf "%s/foot.css" $destination -}}
    {{- end -}}

    {{- if hugo.IsDevelopment -}}
        {{- $path = slice $master_css $format_css $module_css $themes_css $extras_css | resources.Concat $dest  -}}
        {{- with $path -}}
            <link id="pack-loader" rel="preload" href="{{ .RelPermalink }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
            <noscript><link id="pack-styles" rel="stylesheet" href="{{ .RelPermalink }}"></noscript>
        {{- end -}}
    {{- else -}}
        {{- $path = slice $master_css $format_css $module_css $themes_css $extras_css | resources.Concat $dest | minify | fingerprint -}}
        {{- with $path -}}
            <link id="pack-loader" rel="preload" href="{{ .RelPermalink }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
            <noscript><link id="pack-styles" rel="stylesheet" href="{{ .RelPermalink }}" integrity="{{ .Data.Integrity }}"></noscript>
        {{- end -}}
    {{- end -}}
{{- end -}}
