{{- $section := .Section -}}
{{- $formats := .Page.Params.Format -}}
{{- $destination := printf "assets/scripts/" -}}

{{- if .IsHome -}}
    {{- $destination = printf "assets/scripts/home" -}}
{{- end -}}

{{- if .IsSection -}}
    {{- $destination = printf "assets/scripts/%s" .Section -}}
{{ end }}

{{- if .IsPage -}}
    {{- if .Section -}}
        {{- $destination = printf "assets/scripts/%s" .Section -}}
    {{- else -}}
        {{- $destination = printf "assets/scripts/page" -}}
    {{- end -}}
{{- end -}}


{{- $master_jsx := resources.Get "scripts/based/jsx/head.js" -}}
{{- $themes_jsx := resources.Get "scripts/based/jsx/main.js" -}}
{{- $module_jsx := resources.Get "scripts/based/jsx/over.js" -}}
{{- $format_jsx := resources.Get "scripts/based/jsx/over.js" -}}
{{- $extras_jsx := resources.Get "scripts/based/jsx/over.js" -}}


{{- with .Store.Get "module_head_jsx" -}}
    {{- $module_jsx = resources.Get . -}}
{{- end -}}

{{- with .Store.Get "format_head_jsx" -}}
    {{- $format_jsx = resources.Get . -}}
{{- end -}}

{{- with .Site.Params.Themes -}}
    {{- $theme_path := printf "scripts/themes/%s/jsx/head.js" . -}}
    {{- $themes_jsx = resources.Get $theme_path -}}
{{- end -}}

{{- with resources.Get "scripts/module.js" -}}
    {{- $extras_jsx = resources.Get . -}}
{{- end -}}


{{- with and ( resources.Get $master_jsx ) ( resources.Get $module_jsx ) ( resources.Get $format_jsx ) ( resources.Get $themes_jsx ) ( resources.Get $extras_jsx ) -}}

    {{- $dest := "" -}}
    {{- if $formats -}}
        {{- $dest = printf "%s/%s-script.js" $destination $formats -}}
    {{- else -}}
        {{- $dest = printf "%s/head-script.js" $destination -}}
    {{- end -}}

    {{- $opts := dict "minify" (not hugo.IsDevelopment) "sourceMap" (cond hugo.IsDevelopment "external" "") "targetPath" $dest -}}
    {{- $path := slice $master_jsx $module_jsx $format_jsx $themes_jsx $extras_jsx | resources.Concat $dest -}}

    {{- with $path | js.Build $opts -}}
        <script id="head-script">{{- .Content | safeJS -}}</script>
    {{- end -}}

{{- end -}}