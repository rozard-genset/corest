{{- $themes := partial "lib/get-themes.html" . -}}
{{- $module := partial "lib/get-module.html" . -}}
{{- $format := partial "lib/get-format.html" . -}}
{{- $models := partial "lib/get-models.html" . -}}
{{- $pageid := partial "lib/get-pageid.html" . -}}
{{- $contex := . -}}

<main id="blocks-{{ $pageid }}">
{{- range $index, $block := .Page.Params.Blocks -}}

    {{- $based := printf "blocks/%s/%s/%s/render.html" .render.type .render.pool .render.name   -}}
    {{- $theme := printf "themes/%s/blocks/%s/%s/%s/render.html" $themes .render.type .render.pool .render.name -}}
    {{- $modul := printf "module/%s/blocks/%s/%s/%s/render.html" $module .render.type .render.pool .render.name -}}
    {{- $datum := . -}}

    {{- range ( slice $based $theme $modul ) -}}
        {{- if templates.Exists ( printf "partials/%s" . ) -}}
            <section id="block-{{- math.Sum $index 1 -}}" class="block {{ $datum.render.pool }} {{ $datum.render.name }}">
                <div class="{{ with $datum.render.wrap }}wrap{{ end }}">
                    {{- partial . ( dict "ctx" $contex "data" $datum.datum ) -}}
                </div>
            </section>
        {{- end -}}
    {{- end -}}

{{- end -}}
</main>