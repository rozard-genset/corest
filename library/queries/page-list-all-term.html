<!-- populate term -->
{{- $get_term := slice -}}
{{- $set_term := .Site.GetPage ( printf "%s/path" .Section ) -}}
{{- $set_page := where .Site.Pages "Type" .Section -}}

{{- range $set_term.Pages -}}
    {{- if eq .Page.Params.Module.Layout "term" -}}
        {{- $get_term = $get_term | append . -}}
    {{- end -}}
{{- end -}}


<!-- populate page -->
{{- $all_term := $get_term | uniq -}}
{{- $all_page := slice -}} 

{{- range $all_term -}}
    {{- $page_now := .Title -}}
    {{- $term_now := slice ( .Title | urlize ) -}}
    {{- $page_map := slice   -}}
    {{- range $set_page -}}

        {{- $terms := slice -}}

        {{- range .Page.Params.terms -}}E
            {{- $terms = $terms | append ( . | urlize ) -}}
        {{- end -}}

        {{- if collections.Intersect $term_now $terms -}}
            {{- $page_map = $page_map | append . -}}
        {{- end -}}

    {{- end -}}
    
    {{- if gt ( len $page_map ) 0 -}}
        {{- $all_page = $all_page | append ( dict "name" $page_now  "page" . "list" $page_map ) -}}
    {{- end -}}
{{- end -}}

{{- return $all_page -}}