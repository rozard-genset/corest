{{- $block_path := "" -}}
{{- $pages_vars := slice -}}
{{- $block_type := slice "hero" -}}
{{- $destinates := printf "%s/critical/script.js" ( partial "lib/bases/dest.html" . ) -}}


{{- range ( index .Page.Params.Block ) -}}
    {{- $block_vars := .type -}}{{- $block_page := .data -}}
    {{- range $block_type -}}{{- $block_path = printf "scripts/blocks/%s/%s/head.js" . $block_vars -}}
        {{ if resources.Get $block_path }}
            {{ $pages_vars =  $pages_vars | append ( resources.Get $block_path ) }}
        {{ end }}
    {{- end -}}
{{- end -}}


{{- $opts := dict "minify" (not hugo.IsDevelopment) "sourceMap" (cond hugo.IsDevelopment "external" "") "targetPath" $destinates -}}

{{- $path := "" -}}{{- if hugo.IsDevelopment -}}
    {{- $path = $pages_vars | resources.Concat $destinates -}}
{{- else -}}
    {{- $path = $pages_vars | resources.Concat $destinates | minify -}}
{{- end -}}

{{- with $path | js.Build $opts -}}<script>{{- .Content | safeJS -}}</script>{{- end -}}
